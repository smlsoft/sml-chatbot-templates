# Special Queries - ‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

**Database:** sml1  
**Schema:** public  
**Purpose:** Query Templates ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ

**üí° ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:**
- Queries ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô **Templates ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á** ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏î‡πâ
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ **‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå** ‡πÅ‡∏•‡∏∞ context ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
- Keywords ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á** - ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ template ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ
- **‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô** ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ template ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°

---

## 1. ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡∏≠‡∏á (Book Out Quantity)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:** "‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡∏≠‡∏á", "book out", "‡∏à‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤", "‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡∏≠‡∏á" ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:** ‡πÉ‡∏ä‡πâ template ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ EC-00002 ‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£", "‡∏î‡∏π‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ P001"

```sql
WITH bookout as (
 select item_code, sum(bookout_qty_balance) as book_out_qty from (
 select doc_no, item_code, bookout_qty_balance from (
 select doc_no, item_code, qty
 -
 coalesce((
 select sum(qty * (stand_value/divide_value)) from ic_trans_detail
 where (
 (trans_flag = 44 and doc_ref_type = 2)
 or
 (trans_flag = 36 and doc_ref_type = 2)
 or
 ( ic_trans_detail.trans_flag = 39 and (select cancel_type from ic_trans where ic_trans.doc_no = ic_trans_detail.doc_no and ic_trans_detail.trans_flag = ic_trans.trans_flag) = 2)
 ) and last_status = 0 and ic_trans_detail.ref_doc_no = temp1.doc_no and ic_trans_detail.item_code = temp1.item_code
 ), 0) as bookout_qty_balance
 from (
 select doc_no, item_code
 , sum(qty * (stand_value/divide_value)) as qty
 from ic_trans_detail where trans_flag=34 and last_status = 0 and item_code IN ('ITEM_CODE_HERE')
 group by doc_no, item_code
 ) as temp1
 ) as temp2
 ) as temp3 group by item_code
 )
SELECT
  b.item_code,
  i.name_1 as item_name,
  ROUND(b.book_out_qty, 2) as book_out_qty,
  i.unit_standard_name
FROM bookout b
LEFT JOIN ic_inventory i ON b.item_code = i.code
WHERE b.book_out_qty <> 0
ORDER BY b.book_out_qty DESC;
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:** ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `'ITEM_CODE_HERE'` ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏î‡πâ)

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡∏≠‡∏á (‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á), ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏´‡∏ô‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏á", "‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"

```sql
WITH bookout as (
 select item_code, sum(bookout_qty_balance) as book_out_qty from (
 select doc_no, item_code, bookout_qty_balance from (
 select doc_no, item_code, qty
 -
 coalesce((
 select sum(qty * (stand_value/divide_value)) from ic_trans_detail
 where (
 (trans_flag = 44 and doc_ref_type = 2)
 or
 (trans_flag = 36 and doc_ref_type = 2)
 or
 ( ic_trans_detail.trans_flag = 39 and (select cancel_type from ic_trans where ic_trans.doc_no = ic_trans_detail.doc_no and ic_trans_detail.trans_flag = ic_trans.trans_flag) = 2)
 ) and last_status = 0 and ic_trans_detail.ref_doc_no = temp1.doc_no and ic_trans_detail.item_code = temp1.item_code
 ), 0) as bookout_qty_balance
 from (
 select doc_no, item_code
 , sum(qty * (stand_value/divide_value)) as qty
 from ic_trans_detail where trans_flag=34 and last_status = 0
 group by doc_no, item_code
 ) as temp1
 ) as temp2
 ) as temp3 group by item_code
 )
SELECT
  b.item_code,
  i.name_1 as item_name,
  ROUND(b.book_out_qty, 2) as book_out_qty,
  i.unit_standard_name
FROM bookout b
LEFT JOIN ic_inventory i ON b.item_code = i.code
WHERE b.book_out_qty <> 0
ORDER BY b.book_out_qty DESC
LIMIT 30;
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á 30 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

---

## 2. ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡πà‡∏á (Accrued Out Quantity)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:** "‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡πà‡∏á", "accrued out", "‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡πà‡∏á", "‡∏£‡∏≠‡∏™‡πà‡∏á" ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:** ‡πÉ‡∏ä‡πâ template ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 02-15061386 ‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡πà‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£", "‡∏î‡∏π‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ P001"

```sql
WITH accout as (
 select item_code, sum(accout_qty_balance) as acc_out_qty from (
 select doc_no, item_code, accout_qty_balance from (
 select doc_no, item_code, qty
 -
 coalesce((
 select sum(qty * (stand_value/divide_value)) from ic_trans_detail
 where (
 (trans_flag = 44 and doc_ref_type = 3)
 or
 ( ic_trans_detail.trans_flag = 37 and (select cancel_type from ic_trans where ic_trans.doc_no = ic_trans_detail.doc_no and ic_trans_detail.trans_flag = ic_trans.trans_flag) = 2)
 ) and last_status = 0 and ic_trans_detail.ref_doc_no = temp1.doc_no and ic_trans_detail.item_code = temp1.item_code
 ), 0) as accout_qty_balance
 from (
 select doc_no, item_code
 , sum(qty * (stand_value/divide_value)) as qty
 from ic_trans_detail where trans_flag=36 and last_status = 0 and item_code IN ('ITEM_CODE_HERE')
 group by doc_no, item_code
 ) as temp1
 ) as temp2
 ) as temp3 group by item_code
 )
SELECT
  a.item_code,
  i.name_1 as item_name,
  ROUND(a.acc_out_qty, 2) as acc_out_qty,
  i.unit_standard_name
FROM accout a
LEFT JOIN ic_inventory i ON a.item_code = i.code
WHERE a.acc_out_qty <> 0
ORDER BY a.acc_out_qty DESC;
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:** ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `'ITEM_CODE_HERE'` ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏î‡πâ)

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡πà‡∏á (‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á), ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏´‡∏ô‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡πà‡∏á‡∏ö‡πâ‡∏≤‡∏á", "‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"

```sql
WITH accout as (
 select item_code, sum(accout_qty_balance) as acc_out_qty from (
 select doc_no, item_code, accout_qty_balance from (
 select doc_no, item_code, qty
 -
 coalesce((
 select sum(qty * (stand_value/divide_value)) from ic_trans_detail
 where (
 (trans_flag = 44 and doc_ref_type = 3)
 or
 ( ic_trans_detail.trans_flag = 37 and (select cancel_type from ic_trans where ic_trans.doc_no = ic_trans_detail.doc_no and ic_trans_detail.trans_flag = ic_trans.trans_flag) = 2)
 ) and last_status = 0 and ic_trans_detail.ref_doc_no = temp1.doc_no and ic_trans_detail.item_code = temp1.item_code
 ), 0) as accout_qty_balance
 from (
 select doc_no, item_code
 , sum(qty * (stand_value/divide_value)) as qty
 from ic_trans_detail where trans_flag=36 and last_status = 0
 group by doc_no, item_code
 ) as temp1
 ) as temp2
 ) as temp3 group by item_code
 )
SELECT
  a.item_code,
  i.name_1 as item_name,
  ROUND(a.acc_out_qty, 2) as acc_out_qty,
  i.unit_standard_name
FROM accout a
LEFT JOIN ic_inventory i ON a.item_code = i.code
WHERE a.acc_out_qty <> 0
ORDER BY a.acc_out_qty DESC
LIMIT 30;
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á 30 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

---

## 3. ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö (Accrued In Quantity)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:** "‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö", "accrued in", "‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö", "‡∏£‡∏≠‡∏£‡∏±‡∏ö" ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:** ‡πÉ‡∏ä‡πâ template ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ AC-00008 ‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£", "‡∏î‡∏π‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ P001"

```sql
SELECT 
  acc.item_code,
  i.name_1 as item_name,
  ROUND(acc.acc_in_balance, 2) as acc_in_balance,
  i.unit_standard_name
FROM (
  select item_code, sum(acc_in_balance) as acc_in_balance
  from (
   select doc_no, item_code, acc_in_balance from (
   select doc_no, item_code, qty
   -
   coalesce((
   select sum(qty * (stand_value/divide_value)) from ic_trans_detail
   where (
   trans_flag in (12,310)
   or
   ( ic_trans_detail.trans_flag = 7 and (select cancel_type from ic_trans where ic_trans.doc_no = ic_trans_detail.doc_no and ic_trans_detail.trans_flag = ic_trans.trans_flag) = 2)
   ) and last_status = 0 and ic_trans_detail.ref_doc_no = temp1.doc_no and ic_trans_detail.item_code = temp1.item_code
   ), 0) as acc_in_balance
   from (
   select doc_no, item_code
   , sum(qty * (stand_value/divide_value)) as qty
   from ic_trans_detail where trans_flag=6 and last_status = 0 and item_code IN ('ITEM_CODE_HERE')
   group by doc_no, item_code
   ) as temp1
   ) as temp2 where acc_in_balance <> 0
  ) as temp3
  group by item_code
) acc
LEFT JOIN ic_inventory i ON acc.item_code = i.code
WHERE acc.acc_in_balance <> 0
ORDER BY acc.acc_in_balance DESC;
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:** ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `'ITEM_CODE_HERE'` ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏î‡πâ)

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö (‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á), ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1.5: ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "<‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤> ‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£", "<‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô> ‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà"

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** <‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤> = ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡πâ‡∏≤‡∏ô

**‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** ‡πÄ‡∏°‡∏∑‡πà‡∏≠ user ‡πÉ‡∏´‡πâ**‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤** (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏´‡∏±‡∏™) ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Special Query

```sql
SELECT 
  acc.item_code,
  i.name_1 as item_name,
  ROUND(acc.acc_in_balance, 2) as acc_in_balance,
  i.unit_standard_name
FROM (
  select item_code, sum(acc_in_balance) as acc_in_balance
  from (
   select doc_no, item_code, acc_in_balance from (
   select doc_no, item_code, qty
   -
   coalesce((
   select sum(qty * (stand_value/divide_value)) from ic_trans_detail
   where (
   trans_flag in (12,310)
   or
   ( ic_trans_detail.trans_flag = 7 and (select cancel_type from ic_trans where ic_trans.doc_no = ic_trans_detail.doc_no and ic_trans_detail.trans_flag = ic_trans.trans_flag) = 2)
   ) and last_status = 0 and ic_trans_detail.ref_doc_no = temp1.doc_no and ic_trans_detail.item_code = temp1.item_code
   ), 0) as acc_in_balance
   from (
   select doc_no, item_code
   , sum(qty * (stand_value/divide_value)) as qty
   from ic_trans_detail 
   where trans_flag=6 and last_status = 0 
     and item_code IN (
       SELECT code FROM ic_inventory WHERE name_1 LIKE '%ITEM_NAME_HERE%'
     )
   group by doc_no, item_code
   ) as temp1
   ) as temp2 where acc_in_balance <> 0
  ) as temp3
  group by item_code
) acc
LEFT JOIN ic_inventory i ON acc.item_code = i.code
WHERE acc.acc_in_balance <> 0
ORDER BY acc.acc_in_balance DESC;
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:** ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `'%ITEM_NAME_HERE%'` ‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏≠‡∏≠‡∏Å‡∏°‡∏≤)

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö (‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á), ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö

**‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç - ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:**
- User ‡∏û‡∏¥‡∏°‡∏û‡πå: "<‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤> <‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥> <‡∏Ç‡∏ô‡∏≤‡∏î>"
- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà: `WHERE name_1 LIKE '%<‡∏Ñ‡∏≥1>%' OR name_1 LIKE '%<‡∏Ñ‡∏≥2>%' OR name_1 LIKE '%<‡∏Ñ‡∏≥3>%'`
- **‡πÉ‡∏ä‡πâ OR** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤‡∏á ‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏°‡∏µ‡∏Ñ‡∏≥‡πÉ‡∏î‡∏Ñ‡∏≥‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Å‡πá‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÄ‡∏à‡∏≠)
- ‡∏´‡πâ‡∏≤‡∏° hardcode ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞ - ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏´‡∏ô‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏á", "‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"

```sql
WITH accin as (
 select item_code, sum(acc_in_balance) as acc_in_balance
 from (
  select doc_no, item_code, acc_in_balance from (
  select doc_no, item_code, qty
  -
  coalesce((
  select sum(qty * (stand_value/divide_value)) from ic_trans_detail
  where (
  trans_flag in (12,310)
  or
  ( ic_trans_detail.trans_flag = 7 and (select cancel_type from ic_trans where ic_trans.doc_no = ic_trans_detail.doc_no and ic_trans_detail.trans_flag = ic_trans.trans_flag) = 2)
  ) and last_status = 0 and ic_trans_detail.ref_doc_no = temp1.doc_no and ic_trans_detail.item_code = temp1.item_code
  ), 0) as acc_in_balance
  from (
  select doc_no, item_code
  , sum(qty * (stand_value/divide_value)) as qty
  from ic_trans_detail where trans_flag=6 and last_status = 0
  group by doc_no, item_code
  ) as temp1
  ) as temp2 where acc_in_balance <> 0
 ) as temp3
 group by item_code
)
SELECT
  a.item_code,
  i.name_1 as item_name,
  ROUND(a.acc_in_balance, 2) as acc_in_balance,
  i.unit_standard_name
FROM accin a
LEFT JOIN ic_inventory i ON a.item_code = i.code
WHERE a.acc_in_balance <> 0
ORDER BY a.acc_in_balance DESC
LIMIT 30;
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á 30 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)

---

## 4. ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö (Stock Balance by Warehouse & Location)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:** "‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠", "stock balance", "‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠", "‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á", "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠", "‡∏¢‡∏≠‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤", "‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏•‡∏±‡∏á‡πÑ‡∏´‡∏ô", "‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô" ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:** ‡πÉ‡∏ä‡πâ template ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á WHERE clause ‡∏ï‡∏≤‡∏° context

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 885 ‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£", "‡∏î‡∏π‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ AC-00001", "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ BT-00002 ‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏•‡∏±‡∏á‡πÑ‡∏´‡∏ô‡∏ö‡πâ‡∏≤‡∏á"

```sql
select ic_code, warehouse, location, ic_name, ic_unit_code,
ROUND(balance_qty/unit_standard_ratio, 2) as balance_qty,
ROUND(average_cost*unit_standard_ratio, 2) as average_cost,
ROUND(average_cost_end, 2) as average_cost_end,
ROUND(balance_amount, 2) as balance_amount,
ROUND(qty_in/unit_standard_ratio, 2) as qty_in,
ROUND(amount_in, 2) as amount_in,
ROUND(average_cost_in*unit_standard_ratio, 2) as average_cost_in,
ROUND(qty_out/unit_standard_ratio, 2) as qty_out,
ROUND(amount_out, 2) as amount_out,
ROUND(average_cost_out*unit_standard_ratio, 2) as average_cost_out
from (select coalesce((select stand_value/divide_value from ic_unit_use where ic_unit_use.ic_code=temp2.ic_code and ic_unit_use.code=temp2.ic_unit_code),1) as unit_standard_ratio
	  ,ic_code,warehouse,location, ic_name, balance_qty, ic_unit_code, case when balance_qty=0 then 0 else balance_amount/balance_qty end as average_cost
	  , coalesce(((select  average_cost from ic_trans_detail where ic_trans_detail.last_status=0  and ic_trans_detail.item_code=temp2.ic_code and doc_date_calc<=CURRENT_DATE
				   and ((trans_flag in (70,54,60,58,310,12) or (trans_flag=66 and (qty>0 or sum_of_cost>0 )) or (trans_flag=14) or (trans_flag=48 and inquiry_type < 2))
						or (trans_flag in (56,68,72,44) or (trans_flag=66 and (qty<0 or sum_of_cost<0 )) or (trans_flag=46)  or (trans_flag=16 ) or (trans_flag=311 ))
						and not (ic_trans_detail.doc_ref <> '' and ic_trans_detail.is_pos = 1)) order by doc_date_calc desc,doc_time desc ,line_number desc  offset 0 limit 1 )*unit_ratio),0) as average_cost_end
	  ,  balance_amount as balance_amount
	  , qty_in, amount_in, case when qty_in=0 then 0 else amount_in/qty_in end as average_cost_in
	  , qty_out, amount_out, case when qty_out=0 then 0 else amount_out/qty_out end as average_cost_out
	  from (select ic_code,warehouse,location, ic_name, balance_qty, ic_unit_code, (select unit_standard_stand_value/unit_standard_divide_value from ic_inventory where ic_inventory.code=temp1.ic_code) as unit_ratio
			, balance_amount, qty_in, amount_in, qty_out, amount_out
			from (select item_code as ic_code,wh_code as warehouse,shelf_code as location, (select name_1 from ic_inventory where ic_inventory.code=item_code) as ic_name
				  , (select unit_standard from ic_inventory where ic_inventory.code=item_code) as ic_unit_code
				  , coalesce(sum(calc_flag*(case when ((trans_flag in (70,54,60,58,310,12) or (trans_flag=66 and qty>0) or (trans_flag=14 and inquiry_type=0) or (trans_flag=48 and inquiry_type < 2))
													   or (trans_flag in (56,68,72,44) or (trans_flag=66 and qty<0) or (trans_flag=46 and inquiry_type in (0,2))
														   or (trans_flag=16 and inquiry_type in (0,2)) or (trans_flag=311 and inquiry_type=0))
													   and not (ic_trans_detail.doc_ref <> '' and ic_trans_detail.is_pos = 1)) then round((qty*stand_value) / divide_value,2) else 0 end)),0) as balance_qty
				  , coalesce(sum( (calc_flag*(case when ((trans_flag in (70,54,60,58,310,12) or (trans_flag=66 and (qty>0 or sum_of_cost>0 )) or (trans_flag=14) or (trans_flag=48 and inquiry_type < 2))
														 or (trans_flag in (56,68,72,44) or (trans_flag=66 and (qty<0 or sum_of_cost<0 )) or (trans_flag=46)  or (trans_flag=16 ) or (trans_flag=311 ))
														 and not (ic_trans_detail.doc_ref <> '' and ic_trans_detail.is_pos = 1))
											  then(case when trans_flag = 66 and qty < 0 then(-1 * sum_of_cost) + coalesce(profit_lost_cost_amount, 0)
												   else (sum_of_cost + coalesce(profit_lost_cost_amount, 0)) end) else 0 end))),0) as balance_amount
				  , sum(case when doc_date_calc>=CURRENT_DATE - INTERVAL '1 year' and (trans_flag in (70,54,60,58,310,12) or (trans_flag=66 and qty>0) or (trans_flag=14 and inquiry_type=0) or (trans_flag=48 and inquiry_type < 2))
						then calc_flag*round((qty*stand_value)/divide_value,2) else 0 end) as qty_in
				  ,sum(case when doc_date_calc>=CURRENT_DATE - INTERVAL '1 year' and (trans_flag in (70,54,60,58,310,12) or (trans_flag=66 and (qty>0 or sum_of_cost>0 )) or (trans_flag=14) or (trans_flag=48 and inquiry_type < 2))
					   then ((calc_flag*sum_of_cost)+coalesce(profit_lost_cost_amount, 0)) else 0 end) as amount_in
				  , -1*sum(case when doc_date_calc>=CURRENT_DATE - INTERVAL '1 year' and (trans_flag in (56,68,72,44) or (trans_flag=66 and qty<0) or (trans_flag=46 and inquiry_type in (0,2))
																	  or (trans_flag=16 and inquiry_type in (0,2)) or (trans_flag=311 and inquiry_type=0))
						   and not (ic_trans_detail.doc_ref <> '' and ic_trans_detail.is_pos = 1) then calc_flag*round((qty*stand_value)/divide_value,2) else 0 end) as qty_out
				  ,-1 * sum(case when doc_date_calc>=CURRENT_DATE - INTERVAL '1 year' and (trans_flag in (56,68,72,44) or (trans_flag=66 and (qty<0 or sum_of_cost<0 )) or (trans_flag=46)  or (trans_flag=16 ) or (trans_flag=311 ))
							and not (ic_trans_detail.doc_ref <> '' and ic_trans_detail.is_pos = 1)
							then(((case when trans_flag=66 and qty < 0 then -1 else calc_flag end)  *(sum_of_cost + coalesce(profit_lost_cost_amount, 0)))) else 0 end) as amount_out
				  from ic_trans_detail
				  where ic_trans_detail.last_status=0  and ic_trans_detail.item_type<>5  and ic_trans_detail.is_doc_copy =0
				  and (select item_type from ic_inventory where ic_inventory.code = ic_trans_detail.item_code) not in (1,3)  and doc_date_calc<=CURRENT_DATE
				  and item_code IN ('ITEM_CODE_HERE')
				  group by item_code, wh_code, shelf_code
				 ) as temp1
		   ) as temp2
	  WHERE (qty_in<>0  or amount_in<>0 or qty_out<>0 or amount_out<>0 or balance_qty<>0 or balance_amount<>0)
	 ) as final
	 order by ic_code,warehouse,location
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:** ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `'ITEM_CODE_HERE'` ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏î‡πâ)

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏Ñ‡∏•‡∏±‡∏á(warehouse) ‡πÅ‡∏•‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö(location) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á):

- ic_code, warehouse, location, ic_name, ic_unit_code
- balance_qty (‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠), average_cost (‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢)
- balance_amount (‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠)
- qty_in, amount_in (‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
- qty_out, amount_out (‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏î‡∏π‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏´‡∏ô‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ö‡πâ‡∏≤‡∏á", "‡∏î‡∏π‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠"

```sql
select ic_code, warehouse, location, ic_name, ic_unit_code,
ROUND(balance_qty/unit_standard_ratio, 2) as balance_qty,
ROUND(average_cost*unit_standard_ratio, 2) as average_cost,
ROUND(average_cost_end, 2) as average_cost_end,
ROUND(balance_amount, 2) as balance_amount,
ROUND(qty_in/unit_standard_ratio, 2) as qty_in,
ROUND(amount_in, 2) as amount_in,
ROUND(average_cost_in*unit_standard_ratio, 2) as average_cost_in,
ROUND(qty_out/unit_standard_ratio, 2) as qty_out,
ROUND(amount_out, 2) as amount_out,
ROUND(average_cost_out*unit_standard_ratio, 2) as average_cost_out
from (select coalesce((select stand_value/divide_value from ic_unit_use where ic_unit_use.ic_code=temp2.ic_code and ic_unit_use.code=temp2.ic_unit_code),1) as unit_standard_ratio
	  ,ic_code,warehouse,location, ic_name, balance_qty, ic_unit_code, case when balance_qty=0 then 0 else balance_amount/balance_qty end as average_cost
	  , coalesce(((select  average_cost from ic_trans_detail where ic_trans_detail.last_status=0  and ic_trans_detail.item_code=temp2.ic_code and doc_date_calc<=CURRENT_DATE
				   and ((trans_flag in (70,54,60,58,310,12) or (trans_flag=66 and (qty>0 or sum_of_cost>0 )) or (trans_flag=14) or (trans_flag=48 and inquiry_type < 2))
						or (trans_flag in (56,68,72,44) or (trans_flag=66 and (qty<0 or sum_of_cost<0 )) or (trans_flag=46)  or (trans_flag=16 ) or (trans_flag=311 ))
						and not (ic_trans_detail.doc_ref <> '' and ic_trans_detail.is_pos = 1)) order by doc_date_calc desc,doc_time desc ,line_number desc  offset 0 limit 1 )*unit_ratio),0) as average_cost_end
	  ,  balance_amount as balance_amount
	  , qty_in, amount_in, case when qty_in=0 then 0 else amount_in/qty_in end as average_cost_in
	  , qty_out, amount_out, case when qty_out=0 then 0 else amount_out/qty_out end as average_cost_out
	  from (select ic_code,warehouse,location, ic_name, balance_qty, ic_unit_code, (select unit_standard_stand_value/unit_standard_divide_value from ic_inventory where ic_inventory.code=temp1.ic_code) as unit_ratio
			, balance_amount, qty_in, amount_in, qty_out, amount_out
			from (select item_code as ic_code,wh_code as warehouse,shelf_code as location, (select name_1 from ic_inventory where ic_inventory.code=item_code) as ic_name
				  , (select unit_standard from ic_inventory where ic_inventory.code=item_code) as ic_unit_code
				  , coalesce(sum(calc_flag*(case when ((trans_flag in (70,54,60,58,310,12) or (trans_flag=66 and qty>0) or (trans_flag=14 and inquiry_type=0) or (trans_flag=48 and inquiry_type < 2))
													   or (trans_flag in (56,68,72,44) or (trans_flag=66 and qty<0) or (trans_flag=46 and inquiry_type in (0,2))
														   or (trans_flag=16 and inquiry_type in (0,2)) or (trans_flag=311 and inquiry_type=0))
													   and not (ic_trans_detail.doc_ref <> '' and ic_trans_detail.is_pos = 1)) then round((qty*stand_value) / divide_value,2) else 0 end)),0) as balance_qty
				  , coalesce(sum( (calc_flag*(case when ((trans_flag in (70,54,60,58,310,12) or (trans_flag=66 and (qty>0 or sum_of_cost>0 )) or (trans_flag=14) or (trans_flag=48 and inquiry_type < 2))
														 or (trans_flag in (56,68,72,44) or (trans_flag=66 and (qty<0 or sum_of_cost<0 )) or (trans_flag=46)  or (trans_flag=16 ) or (trans_flag=311 ))
														 and not (ic_trans_detail.doc_ref <> '' and ic_trans_detail.is_pos = 1))
											  then(case when trans_flag = 66 and qty < 0 then(-1 * sum_of_cost) + coalesce(profit_lost_cost_amount, 0)
												   else (sum_of_cost + coalesce(profit_lost_cost_amount, 0)) end) else 0 end))),0) as balance_amount
				  , sum(case when doc_date_calc>=CURRENT_DATE - INTERVAL '1 year' and (trans_flag in (70,54,60,58,310,12) or (trans_flag=66 and qty>0) or (trans_flag=14 and inquiry_type=0) or (trans_flag=48 and inquiry_type < 2))
						then calc_flag*round((qty*stand_value)/divide_value,2) else 0 end) as qty_in
				  ,sum(case when doc_date_calc>=CURRENT_DATE - INTERVAL '1 year' and (trans_flag in (70,54,60,58,310,12) or (trans_flag=66 and (qty>0 or sum_of_cost>0 )) or (trans_flag=14) or (trans_flag=48 and inquiry_type < 2))
					   then ((calc_flag*sum_of_cost)+coalesce(profit_lost_cost_amount, 0)) else 0 end) as amount_in
				  , -1*sum(case when doc_date_calc>=CURRENT_DATE - INTERVAL '1 year' and (trans_flag in (56,68,72,44) or (trans_flag=66 and qty<0) or (trans_flag=46 and inquiry_type in (0,2))
																	  or (trans_flag=16 and inquiry_type in (0,2)) or (trans_flag=311 and inquiry_type=0))
						   and not (ic_trans_detail.doc_ref <> '' and ic_trans_detail.is_pos = 1) then calc_flag*round((qty*stand_value)/divide_value,2) else 0 end) as qty_out
				  ,-1 * sum(case when doc_date_calc>=CURRENT_DATE - INTERVAL '1 year' and (trans_flag in (56,68,72,44) or (trans_flag=66 and (qty<0 or sum_of_cost<0 )) or (trans_flag=46)  or (trans_flag=16 ) or (trans_flag=311 ))
							and not (ic_trans_detail.doc_ref <> '' and ic_trans_detail.is_pos = 1)
							then(((case when trans_flag=66 and qty < 0 then -1 else calc_flag end)  *(sum_of_cost + coalesce(profit_lost_cost_amount, 0)))) else 0 end) as amount_out
				  from ic_trans_detail
				  where ic_trans_detail.last_status=0  and ic_trans_detail.item_type<>5  and ic_trans_detail.is_doc_copy =0
				  and (select item_type from ic_inventory where ic_inventory.code = ic_trans_detail.item_code) not in (1,3)  and doc_date_calc<=CURRENT_DATE
				  group by item_code, wh_code, shelf_code
				 ) as temp1
		   ) as temp2
	  WHERE (qty_in<>0  or amount_in<>0 or qty_out<>0 or amount_out<>0 or balance_qty<>0 or balance_amount<>0)
	 ) as final
	 where balance_qty <> 0
	 order by balance_qty desc, ic_code, warehouse, location
	 LIMIT 100
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á 100 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)

---

## ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

### ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Special Queries

- Query ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô **Business Logic ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô** ‡∏´‡πâ‡∏≤‡∏° AI ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏á
- **‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Query ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô** ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `'ITEM_CODE_HERE'`
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™: ‡πÉ‡∏ä‡πâ Query ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2 (‡∏°‡∏µ JOIN ‡∏Å‡∏±‡∏ö ic_inventory)

### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

- **‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1:** ‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ item_code ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
- **‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2:** ‡πÑ‡∏î‡πâ item_code, item_name, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô, unit_standard_name

### ‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° Special Query ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ
- ‡πÅ‡∏ï‡πà‡∏•‡∏∞ Query ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ 2 ‡∏Å‡∏£‡∏ì‡∏µ (‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™ / ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™)

---

## 5. ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ (Best Selling Items)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ", "‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î", "best seller", "‡∏Ç‡∏≤‡∏¢‡πÄ‡∏¢‡∏≠‡∏∞", "‡∏ô‡∏¥‡∏¢‡∏°" ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:** ‡πÉ‡∏ä‡πâ template ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÑ‡∏î‡πâ

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏´‡∏ô‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î", "‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ Top 10", "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î"

```sql
SELECT 
  itd.item_code,
  i.name_1 as item_name,
  ROUND(SUM(ABS(itd.qty * itd.stand_value / itd.divide_value)), 2) as total_qty_sold,
  i.unit_standard_name,
  COUNT(DISTINCT itd.doc_no) as transaction_count
FROM ic_trans_detail itd
LEFT JOIN ic_inventory i ON itd.item_code = i.code
WHERE itd.last_status = 0
  AND itd.trans_flag IN (44, 56, 68, 72)
  AND itd.doc_date_calc >= CURRENT_DATE - INTERVAL '1 year'
  AND i.item_type NOT IN (1, 3)
GROUP BY itd.item_code, i.name_1, i.unit_standard_name
HAVING SUM(ABS(itd.qty * itd.stand_value / itd.divide_value)) > 0
ORDER BY total_qty_sold DESC
LIMIT 30;
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á 30 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏£‡∏≠‡∏ö 1 ‡∏õ‡∏µ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:**
- `trans_flag IN (44, 56, 68, 72)` = ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å/‡∏Ç‡∏≤‡∏¢
- ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 1 ‡∏õ‡∏µ
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

---

## 6. ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á (Items in Warehouse)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á", "‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏±‡∏á", "‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏•‡∏±‡∏á", "warehouse" ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:** ‡πÉ‡∏ä‡πâ template ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á WHERE clause ‡∏ï‡∏≤‡∏° context

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏±‡∏á ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** 
- "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏±‡∏á <‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏±‡∏á> ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á"
- "‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á <‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏±‡∏á>"
- "‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤> ‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏•‡∏±‡∏á‡πÑ‡∏´‡∏ô‡∏ö‡πâ‡∏≤‡∏á"
- "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ <‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤> ‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏•‡∏±‡∏á‡πÑ‡∏´‡∏ô"

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** <‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏±‡∏á>, <‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤>, <‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤> = ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡πâ‡∏≤‡∏ô

**‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1.1: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏±‡∏á**
```sql
SELECT DISTINCT
  itd.item_code,
  i.name_1 as item_name,
  itd.wh_code as warehouse,
  i.unit_standard_name,
  ROUND(SUM(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2)), 2) as balance_qty
FROM ic_trans_detail itd
LEFT JOIN ic_inventory i ON itd.item_code = i.code
WHERE itd.last_status = 0
  AND itd.item_type <> 5
  AND itd.is_doc_copy = 0
  AND i.item_type NOT IN (1, 3)
  AND itd.doc_date_calc <= CURRENT_DATE
  AND UPPER(itd.wh_code) = UPPER('WAREHOUSE_NAME_HERE')
GROUP BY itd.item_code, i.name_1, itd.wh_code, i.unit_standard_name
HAVING SUM(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2)) <> 0
ORDER BY balance_qty DESC
LIMIT 100;
```
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:** ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `'WAREHOUSE_NAME_HERE'` ‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏±‡∏á

**‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1.2: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏•‡∏±‡∏á‡πÑ‡∏´‡∏ô)**
```sql
SELECT DISTINCT
  itd.item_code,
  i.name_1 as item_name,
  itd.wh_code as warehouse,
  itd.shelf_code as location,
  i.unit_standard_name,
  ROUND(SUM(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2)), 2) as balance_qty
FROM ic_trans_detail itd
LEFT JOIN ic_inventory i ON itd.item_code = i.code
WHERE itd.last_status = 0
  AND itd.item_type <> 5
  AND itd.is_doc_copy = 0
  AND i.item_type NOT IN (1, 3)
  AND itd.doc_date_calc <= CURRENT_DATE
  AND (
    itd.item_code = 'ITEM_CODE_HERE'
    OR UPPER(i.name_1) LIKE UPPER('%ITEM_NAME_HERE%')
  )
GROUP BY itd.item_code, i.name_1, itd.wh_code, itd.shelf_code, i.unit_standard_name
HAVING SUM(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2)) <> 0
ORDER BY itd.wh_code, balance_qty DESC
LIMIT 100;
```
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:** 
- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `'ITEM_CODE_HERE'` ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠
- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `'%ITEM_NAME_HERE%'` ‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÉ‡∏ä‡πâ % ‡∏Ñ‡∏£‡∏≠‡∏ö)
- ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á 2 Ï°∞Í±¥ ‡πÇ‡∏î‡∏¢ AI ‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏° context

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏•‡∏±‡∏á‡πÑ‡∏´‡∏ô‡∏ö‡πâ‡∏≤‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏•‡∏±‡∏á (‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏•‡∏±‡∏á)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏•‡∏±‡∏á‡πÑ‡∏´‡∏ô‡∏ö‡πâ‡∏≤‡∏á", "‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏Ñ‡∏•‡∏±‡∏á"

```sql
SELECT 
  itd.wh_code as warehouse,
  COUNT(DISTINCT itd.item_code) as item_count,
  ROUND(SUM(ABS(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2))), 2) as total_qty
FROM ic_trans_detail itd
LEFT JOIN ic_inventory i ON itd.item_code = i.code
WHERE itd.last_status = 0
  AND itd.item_type <> 5
  AND itd.is_doc_copy = 0
  AND i.item_type NOT IN (1, 3)
  AND itd.doc_date_calc <= CURRENT_DATE
GROUP BY itd.wh_code
HAVING SUM(ABS(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2))) > 0
ORDER BY item_count DESC;
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏•‡∏±‡∏á

---

## 7. ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ (Stock Balance by Customer/AR)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:** "‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ï‡∏≤‡∏°‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ", "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤", "‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤", "‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á" ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:** ‡πÉ‡∏ä‡πâ template ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ/‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏≤‡∏¢/AR)

**üí° ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** Query ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ `trans_type = 1` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏≤‡∏¢/‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ XXX ‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á", "‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ABC", "‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ YYY ‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏õ‡∏ö‡πâ‡∏≤‡∏á"

```sql
SELECT 
  itd.item_code,
  i.name_1 as item_name,
  ar.code as customer_code,
  ar.name_1 as customer_name,
  ROUND(SUM(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2)), 2) as balance_qty,
  i.unit_standard_name,
  COUNT(DISTINCT itd.doc_no) as transaction_count
FROM ic_trans_detail itd
LEFT JOIN ic_inventory i ON itd.item_code = i.code
LEFT JOIN ar_customer ar ON itd.cust_code = ar.code
WHERE itd.last_status = 0
  AND itd.trans_type = 1
  AND ar.status = 0
  AND (ar.code LIKE '%CUSTOMER_CODE_OR_NAME%' OR ar.name_1 LIKE '%CUSTOMER_CODE_OR_NAME%')
GROUP BY itd.item_code, i.name_1, ar.code, ar.name_1, i.unit_standard_name
HAVING SUM(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2)) <> 0
ORDER BY balance_qty DESC
LIMIT 30;
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:** ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `'%CUSTOMER_CODE_OR_NAME%'` ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ, ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠, ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏´‡∏ô‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡∏ö‡πâ‡∏≤‡∏á", "‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ"

```sql
SELECT 
  itd.item_code,
  i.name_1 as item_name,
  COUNT(DISTINCT ar.code) as customer_count,
  ROUND(SUM(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2)), 2) as total_qty,
  i.unit_standard_name
FROM ic_trans_detail itd
LEFT JOIN ic_inventory i ON itd.item_code = i.code
LEFT JOIN ar_customer ar ON itd.cust_code = ar.code
WHERE itd.last_status = 0
  AND itd.trans_type = 1
  AND ar.status = 0
GROUP BY itd.item_code, i.name_1, i.unit_standard_name
HAVING SUM(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2)) <> 0
ORDER BY customer_count DESC, total_qty DESC
LIMIT 30;
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°

---

## 8. ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ (Stock Balance by Supplier/AP)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:** "‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ï‡∏≤‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ", "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå", "‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ", "‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏ö‡πâ‡∏≤‡∏á" ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:** ‡πÉ‡∏ä‡πâ template ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ/‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå (‡∏ù‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠/AP)

**üí° ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** Query ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ `trans_type = 2` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ù‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠/‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ XXX ‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏ö‡πâ‡∏≤‡∏á", "‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå ABC", "‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ YYY ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á"

```sql
SELECT 
  itd.item_code,
  i.name_1 as item_name,
  ap.code as supplier_code,
  ap.name_1 as supplier_name,
  ROUND(SUM(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2)), 2) as balance_qty,
  i.unit_standard_name,
  COUNT(DISTINCT itd.doc_no) as transaction_count
FROM ic_trans_detail itd
LEFT JOIN ic_inventory i ON itd.item_code = i.code
LEFT JOIN ap_supplier ap ON itd.cust_code = ap.code
WHERE itd.last_status = 0
  AND itd.trans_type = 2
  AND ap.status = 0
  AND (ap.code LIKE '%SUPPLIER_CODE_OR_NAME%' OR ap.name_1 LIKE '%SUPPLIER_CODE_OR_NAME%')
GROUP BY itd.item_code, i.name_1, ap.code, ap.name_1, i.unit_standard_name
HAVING SUM(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2)) <> 0
ORDER BY balance_qty DESC
LIMIT 30;
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:** ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà `'%SUPPLIER_CODE_OR_NAME%'` ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ, ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠, ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:** "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏´‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡∏ö‡πâ‡∏≤‡∏á", "‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ"

```sql
SELECT 
  itd.item_code,
  i.name_1 as item_name,
  COUNT(DISTINCT ap.code) as supplier_count,
  ROUND(SUM(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2)), 2) as total_qty,
  i.unit_standard_name
FROM ic_trans_detail itd
LEFT JOIN ic_inventory i ON itd.item_code = i.code
LEFT JOIN ap_supplier ap ON itd.cust_code = ap.code
WHERE itd.last_status = 0
  AND itd.trans_type = 2
  AND ap.status = 0
GROUP BY itd.item_code, i.name_1, i.unit_standard_name
HAVING SUM(itd.calc_flag * ROUND((itd.qty * itd.stand_value) / itd.divide_value, 2)) <> 0
ORDER BY supplier_count DESC, total_qty DESC
LIMIT 30;
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°

---

## üìå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Query #7 ‡πÅ‡∏•‡∏∞ #8

**‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ö‡∏£‡∏¥‡∏ö‡∏ó:**
- AI ‡∏ï‡πâ‡∏≠‡∏á**‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°**‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ Query ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
- **‡∏´‡πâ‡∏≤‡∏° hardcode keywords** - ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à

**‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ:**
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö **‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ/‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏Ç‡∏≤‡∏¢/AR** ‚Üí ‡πÉ‡∏ä‡πâ Query #7 (trans_type=1)
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö **‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ/‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå/‡∏ã‡∏∑‡πâ‡∏≠/AP** ‚Üí ‡πÉ‡∏ä‡πâ Query #8 (trans_type=2)

**‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á:**
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° WHERE clause ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏•‡∏±‡∏á, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà)
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° JOIN ‡∏Å‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö GROUP BY ‡πÅ‡∏•‡∏∞ ORDER BY ‡∏ï‡∏≤‡∏°‡∏ö‡∏£‡∏¥‡∏ö‡∏ó

---

**Version:** 1.2  
**Last Updated:** December 29, 2025
